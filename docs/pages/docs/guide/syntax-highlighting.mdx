import { OptionTable } from 'components/table'
import { Callout } from 'nextra/components'

# è¯­æ³•é«˜äº®

Nextra ä½¿ç”¨ [Shiki](https://shiki.matsu.io) åœ¨æ„å»ºæ—¶è¿›è¡Œè¯­æ³•é«˜äº®ã€‚è¿™éå¸¸å¯é ä¸”é«˜æ•ˆã€‚ä¾‹å¦‚ï¼Œåœ¨æ‚¨çš„ Markdown æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

````md filename="Markdown"
```js
console.log('hello, world')
```
````

æœ€ç»ˆæ•ˆæœï¼š

```js
console.log('hello, world')
```

## ç‰¹æ€§

### è¡Œå†…ä»£ç 

é€šè¿‡ `{:}` è¯­æ³•æ”¯æŒå†…è”è¯­æ³•é«˜äº®ï¼Œä¾‹å¦‚ `let x = 1{:jsx}`ï¼š

```md filename="Markdown"
é€šè¿‡ `{:}` è¯­æ³•æ”¯æŒå†…è”è¯­æ³•é«˜äº®ï¼Œä¾‹å¦‚ `let x = 1{:jsx}`ï¼š
```

### Highlighting Lines

é€šè¿‡åœ¨ä»£ç å—ä¸­æ·»åŠ  `{}` å±æ€§ï¼Œå¯ä»¥é«˜äº®ç‰¹å®šçš„ä»£ç è¡Œï¼š

````md filename="Markdown"
```js {1,4-5}
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```
````

æœ€ç»ˆæ•ˆæœï¼š

```js {1,4-5}
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

### é«˜äº®å­å­—ç¬¦ä¸²

é€šè¿‡åœ¨ä»£ç å—ä¸­æ·»åŠ  `//` å±æ€§ï¼Œå¯ä»¥é«˜äº®ç‰¹å®šçš„å­å­—ç¬¦ä¸²ï¼š

````md filename="Markdown"
```js /useState/
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```
````

æœ€ç»ˆæ•ˆæœï¼š

```js /useState/
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

æ‚¨å¯ä»¥é€šè¿‡åœ¨å­å­—ç¬¦ä¸²åæ·»åŠ æ•°å­—æ¥åªé«˜äº®éƒ¨åˆ†å‡ºç°çš„å­å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š`/str/1`ï¼Œæˆ–è€…é«˜äº®å¤šä¸ªç‰¹å®šçš„éƒ¨åˆ†ï¼š`/str/1-3`ã€`/str/1,3`ã€‚

### å¤åˆ¶æŒ‰é’®

é€šè¿‡æ·»åŠ  `copy` å±æ€§ï¼Œå½“ç”¨æˆ·æ‚¬åœæ—¶ï¼Œå°†åœ¨ä»£ç å—ä¸Šæ·»åŠ ä¸€ä¸ªå¤åˆ¶æŒ‰é’®ï¼š

````md filename="Markdown"
```js copy
console.log('hello, world')
```
````

æœ€ç»ˆæ•ˆæœï¼š

```js copy
console.log('hello, world')
```

æ‚¨å¯ä»¥é€šè¿‡åœ¨ Nextra é…ç½®æ–‡ä»¶ï¼ˆ`next.config.js` æ–‡ä»¶ï¼‰ä¸­è®¾ç½® `defaultShowCopyCode: true` æ¥å…¨å±€å¯ç”¨æ­¤åŠŸèƒ½ã€‚ä¸€æ—¦å…¨å±€å¯ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ `copy=false` å±æ€§æ¥ç¦ç”¨å®ƒã€‚

### è¡Œå·

é€šè¿‡æ·»åŠ  `showLineNumbers` å±æ€§ï¼Œå¯ä»¥åœ¨ä»£ç å—ä¸­æ·»åŠ è¡Œå·ï¼š

````md filename="Markdown"
```js showLineNumbers
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```
````

æœ€ç»ˆæ•ˆæœï¼š

```js showLineNumbers
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

### æ–‡ä»¶åå’Œæ ‡é¢˜

é€šè¿‡æ·»åŠ  `filename` å±æ€§ï¼Œæ‚¨å¯ä»¥ä¸ºä»£ç å—æ·»åŠ æ–‡ä»¶åæˆ–æ ‡é¢˜ï¼š

````md filename="Markdown"
```js filename="example.js"
console.log('hello, world')
```
````

æœ€ç»ˆæ•ˆæœï¼š

```js filename="example.js"
console.log('hello, world')
```

### ANSI é«˜äº®

æ‚¨å¯ä»¥é«˜äº® ANSI è½¬ä¹‰ç ï¼š

````md filename="Markdown"
```ansi
[0m [0;32mâœ“[0m [0;2msrc/[0mindex[0;2m.test.ts (1)[0m
  [0;2m Test Files [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m      Tests [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m   Start at [0m 23:32:41
  [0;2m   Duration [0m 11ms
  [42;1;39;0m PASS [0;32m Waiting for file changes...[0m
         [0;2mpress [0;1mh[0;2m to show help, press [0;1mq[0;2m to quit
```
````

æœ€ç»ˆæ•ˆæœï¼š

```ansi
[0m [0;32mâœ“[0m [0;2msrc/[0mindex[0;2m.test.ts (1)[0m
  [0;2m Test Files [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m      Tests [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m   Start at [0m 23:32:41
  [0;2m   Duration [0m 11ms
  [42;1;39;0m PASS [0;32m Waiting for file changes...[0m
         [0;2mpress [0;1mh[0;2m to show help, press [0;1mq[0;2m to quit
```

## æ”¯æŒçš„è¯­è¨€

æŸ¥çœ‹[æ­¤åˆ—è¡¨](https://github.com/shikijs/shiki/blob/main/docs/languages.md)äº†è§£æ‰€æœ‰æ”¯æŒçš„è¯­è¨€ã€‚

## è‡ªå®šä¹‰ä¸»é¢˜

Nextra ä½¿ç”¨ CSS å˜é‡å®šä¹‰æ ‡è®°çš„é¢œè‰²ã€‚æ‚¨å¯ä»¥æ³¨å…¥ä¸€ä¸ª[å…¨å±€ CSS](https://nextjs.org/docs/basic-features/built-in-css-support#adding-a-global-stylesheet)æ¥åœ¨æµ…è‰²/æ·±è‰²ä¸»é¢˜ä¸‹è‡ªå®šä¹‰å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯é»˜è®¤çš„æ ‡è®°ï¼Œæ‚¨å¯ä»¥è¦†ç›–å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼š

```css filename="styles.css"
:root {
  --shiki-color-text: #414141;
  --shiki-color-background: transparent;
  --shiki-token-constant: #1976d2;
  --shiki-token-string: #22863a;
  --shiki-token-comment: #aaa;
  --shiki-token-keyword: #d32f2f;
  --shiki-token-parameter: #ff9800;
  --shiki-token-function: #6f42c1;
  --shiki-token-string-expression: #22863a;
  --shiki-token-punctuation: #212121;
  --shiki-token-link: #22863a;
}

.dark {
  --shiki-color-text: #d1d1d1;
  --shiki-token-constant: #79b8ff;
  --shiki-token-string: #ffab70;
  --shiki-token-comment: #6b737c;
  --shiki-token-keyword: #f97583;
  --shiki-token-parameter: #ff9800;
  --shiki-token-function: #b392f0;
  --shiki-token-string-expression: #4bb74a;
  --shiki-token-punctuation: #bbb;
  --shiki-token-link: #ffab70;
}
```

## åŠ¨æ€å†…å®¹

ç”±äºè¯­æ³•é«˜äº®æ˜¯åœ¨æ„å»ºæ—¶å®Œæˆçš„ï¼Œæ‚¨ä¸èƒ½åœ¨ä»£ç å—ä¸­ä½¿ç”¨åŠ¨æ€å†…å®¹ã€‚ç„¶è€Œï¼Œç”±äº MDX éå¸¸å¼ºå¤§ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ JS æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¾‹å¦‚ï¼š

import { useEffect, useRef } from 'react'

export function DynamicCode({ children }) {
  const ref = useRef()
  const tokenRef = useRef()
  // ä» DOM ä¸­æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°
  useEffect(() => {
    if (ref.current) {
      const token = [...ref.current.querySelectorAll('code span')].find(
        el => el.innerText === '1'
      )
      tokenRef.current = token
    }
  }, [])
  return (
    <>
      <div ref={ref} style={{ marginTop: '1.5rem' }}>
        {children}
      </div>
      <a
        onClick={() => {
          tokenRef.current.innerText =
            (parseInt(tokenRef.current.innerText) || 0) + 1
        }}
        style={{
          cursor: 'pointer',
          userSelect: 'none'
        }}
      >
        Increase the number
      </a>
      <a
        onClick={() => {
          tokenRef.current.innerText = '1 + 1'
        }}
        style={{
          marginLeft: '.5rem',
          cursor: 'pointer',
          userSelect: 'none'
        }}
      >
        Change to `1 + 1`
      </a>
    </>
  )
}

<DynamicCode>
```js filename="dynamic_code.js"
function hello () {
  const x = 2 + 3
  console.log(1)
}
```
</DynamicCode>

è¿™ç§æ–¹æ³•çš„é™åˆ¶æ˜¯æ›´æ–°çš„å†…å®¹ä¸ä¼šé‡æ–°é«˜äº®æ˜¾ç¤ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°†æ•°å­—æ›´æ–°ä¸º `1 + 1`ï¼Œå®ƒå°†è¢«é”™è¯¯åœ°é«˜äº®æ˜¾ç¤ºã€‚

æŸ¥çœ‹[ä»£ç ](https://github.com/shuding/nextra/blob/main/docs/pages/docs/guide/syntax-highlighting.mdx)äº†è§£å…¶å·¥ä½œåŸç†ã€‚

## ç¦ç”¨è¯­æ³•é«˜äº®

æ‚¨å¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨è¯­æ³•é«˜äº®ï¼Œæ”¹ç”¨è‡ªå·±çš„æ–¹æ¡ˆã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨ Nextra é…ç½®æ–‡ä»¶ï¼ˆ`next.config.js` æ–‡ä»¶ï¼‰ä¸­è®¾ç½® `codeHighlight: false` æ¥å…¨å±€ç¦ç”¨è¯­æ³•é«˜äº®ã€‚

<OptionTable
  options={[
    [
      'codeHighlight',
      'boolean',
      'å¯ç”¨æˆ–ç¦ç”¨è¯­æ³•é«˜äº®ã€‚é»˜è®¤ä¸º `true`ã€‚'
    ]
  ]}
/>

## è‡ªå®šä¹‰è¯­æ³•

Shiki æ¥å—[VSCode TextMate è¯­æ³•](https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide)ç”¨äºè‡ªå®šä¹‰è¯­è¨€è¯­æ³•çš„è¯­æ³•é«˜äº®ã€‚

æ‚¨å¯ä»¥é€šè¿‡è¦†ç›– Nextra é…ç½®ä¸­çš„ `next.config.js` æ–‡ä»¶å†…çš„ `mdxOptions.rehypePrettyCodeOptions` é€‰é¡¹ä¸­çš„ `getHighlighter` å‡½æ•°æ¥æä¾›è¿™äº›è¯­æ³•ï¼š

```js filename="next.config.js" {13-18}
import { BUNDLED_LANGUAGES } from 'shiki'

nextra({
  // ... other options
  mdxOptions: {
    rehypePrettyCodeOptions: {
      getHighlighter: options =>
        getHighlighter({
          ...options,
          langs: [
            ...BUNDLED_LANGUAGES,
            // è‡ªå®šä¹‰è¯­æ³•é€‰é¡¹ï¼Œè¯¦è§ Shiki æ–‡æ¡£äº†è§£å¦‚ä½•æä¾›è¿™äº›é€‰é¡¹
            {
              id: 'my-lang',
              scopeName: 'source.my-lang',
              aliases: ['mylang'], // é™¤äº† idï¼Œåˆ«åä¹Ÿå°†åŒ…å«åœ¨å…è®¸ä½¿ç”¨çš„åç§°ä¸­ï¼Œç”¨äºç¼–å†™ markdownã€‚
              path: '../../public/syntax/grammar.tmLanguage.json'
            }
          ]
        })
    }
  }
})
```

## è‡ªå®šä¹‰ä¸»é¢˜

åœ¨ `mdxOptions.rehypePrettyCodeOptions` ä¸­ï¼Œæ‚¨è¿˜å¯ä»¥æä¾›è‡ªå®šä¹‰ä¸»é¢˜ï¼Œè€Œä¸æ˜¯[ä¾èµ– CSS å˜é‡](/docs/guide/syntax-highlighting):

```js filename="next.config.js" {4}
nextra({
  // ...å…¶ä»–é€‰é¡¹
  mdxOptions: {
    rehypePrettyCodeOptions: {
      // VSCode ä¸»é¢˜æˆ–å†…ç½® Shiki ä¸»é¢˜ï¼Œè¯¦è§ Shiki æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯
      theme: JSON.parse(
        readFileSync('./public/syntax/arctis_light.json', 'utf8')
      )
    }
  }
})
```

### å¤šä¸»é¢˜

Nextra ç›®å‰ä¸æ”¯æŒå¤šä¸»é¢˜ã€‚å› ä¸º Shiki ä¸ºæ¯ä¸ªä¸»é¢˜æ¸²æŸ“å¤šä¸ªä»£ç å—ï¼Œå¹¶ä¸ºå®ƒä»¬æ·»åŠ  `data-theme` å±æ€§ï¼Œä¾‹å¦‚ `data-theme="dark"`ã€‚

<Callout type="info">
  ç„¶è€Œæœªæ¥å°†ä¼šæ”¯æŒå¤šä¸»é¢˜ã€‚ ä½ å¯ä»¥åœ¨ shikiji (Shiki çš„æ–°åˆ†æ”¯) ä¸­è·Ÿè¸ªè¿›åº¦ã€‚
  https://github.com/antfu/shikiji#multiple-themes
  å·²ç»æ”¯æŒå¤šä¸»é¢˜è€Œæ— éœ€æ¸²æŸ“å¤šä¸ªä»£ç å—ã€‚
</Callout>
